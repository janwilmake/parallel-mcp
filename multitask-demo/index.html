<!DOCTYPE html>
<html>

<head>
    <title>Parallel Tasks MCP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://assets.p0web.com/FTSystemMono-Regular.woff2" rel="preload" as="font" type="font/woff2"
        crossorigin>
    <style>
        @font-face {
            font-family: 'FT System Mono';
            src: url('https://assets.p0web.com/FTSystemMono-Regular.woff2') format('woff2');
        }

        body {
            font-family: 'FT System Mono', monospace;
            background: #fcfcfa;
            color: #1d1b16;
        }

        .neural {
            background: #d8d0bf;
        }

        .signal {
            color: #fb631b;
        }
    </style>
</head>

<body class="min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2">Parallel Tasks</h1>
            <p class="text-gray-600">Batch process tasks at scale</p>
        </div>

        <div class="flex flex-wrap gap-2 mb-4 justify-center">
            <button id="openVscode"
                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">
                Open in VS Code
            </button>
            <button id="openCursor"
                class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition-colors">
                Open in Cursor
            </button>
            <a class="bg-orange-400 text-white px-4 py-2 rounded hover:bg-orange-500 transition-colors"
                href="https://smithery.ai/server/@janwilmake/parallel-tasks" target="_blank">More Options</a>
            <button id="copyMcpUrl"
                class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors">
                Copy MCP URL
            </button>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <form id="taskForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium mb-2">Parallel API Key</label>
                    <input type="password" id="apiKey" class="w-full p-3 border rounded-lg"
                        placeholder="Enter your Parallel API key" required>
                    <p class="text-sm text-gray-500 mt-1">Your API key is stored locally in your browser</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Output Type</label>
                        <select id="outputType" class="w-full p-3 border rounded-lg" required>
                            <option value="json">JSON</option>
                            <option value="text">Text</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Processor (optional)</label>
                        <select id="processor" class="w-full p-3 border rounded-lg">
                            <option value="">Auto-suggest</option>
                            <option value="lite">Lite</option>
                            <option value="base">Base</option>
                            <option value="core">Core</option>
                            <option value="pro">Pro</option>
                            <option value="ultra">Ultra</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Output Description</label>
                    <textarea id="outputDescription" class="w-full p-3 border rounded-lg h-24"
                        placeholder="Describe what you want the output to contain..."></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Output Schema (JSON only, optional)</label>
                    <textarea id="outputSchema" class="w-full p-3 border rounded-lg h-32 font-mono text-sm"
                        placeholder='{"type": "object", "properties": {...}}'></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Inputs</label>
                    <textarea id="inputs" class="w-full p-3 border rounded-lg h-48 font-mono text-sm"
                        placeholder="Enter JSON array of inputs or URL to fetch inputs" required></textarea>
                    <p class="text-sm text-gray-500 mt-1">Enter a JSON array of objects or a URL that returns a JSON
                        array</p>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Webhook URL (optional)</label>
                    <input type="url" id="webhookUrl" class="w-full p-3 border rounded-lg"
                        placeholder="https://your-webhook-url.com">
                    <p class="text-sm text-gray-500 mt-1">We'll POST to this URL when all tasks are complete</p>
                </div>

                <div class="flex gap-4">
                    <button type="submit"
                        class="flex-1 signal bg-orange-500 text-white py-3 px-6 rounded-lg hover:bg-orange-600 transition-colors">
                        Create Task Group
                    </button>
                    <button type="button" id="loadExample"
                        class="neural px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors">
                        Load Example
                    </button>
                </div>
            </form>
        </div>

        <div id="results" class="hidden bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-4">Task Group Created!</h2>
            <p class="mb-4">Your task group URL: <a id="resultUrl" class="signal underline" target="_blank"></a></p>
            <div class="flex flex-wrap gap-2">
                <a id="jsonLink" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors"
                    target="_blank">View JSON</a>
                <a id="htmlLink" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors"
                    target="_blank">View HTML</a>
                <a id="mdLink" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 transition-colors"
                    target="_blank">View Markdown</a>
                <a id="sseLink" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 transition-colors"
                    target="_blank">Live Stream</a>
                <a id="dbLink" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition-colors"
                    target="_blank">Database Studio</a>
            </div>
        </div>
    </div>

    <script>
        // Load API key from localStorage
        const apiKeyInput = document.getElementById('apiKey');
        const savedApiKey = localStorage.getItem('parallelApiKey');
        if (savedApiKey) {
            apiKeyInput.value = savedApiKey;
        }

        // Save API key to localStorage on input
        apiKeyInput.addEventListener('input', () => {
            localStorage.setItem('parallelApiKey', apiKeyInput.value);
        });

        // Load example data
        document.getElementById('loadExample').addEventListener('click', () => {
            document.getElementById('outputType').value = 'json';
            document.getElementById('processor').value = 'lite';
            document.getElementById('outputDescription').value = 'Extract company information including CEO, industry, and revenue';
            document.getElementById('outputSchema').value = JSON.stringify({
                "type": "object",
                "properties": {
                    "company_name": { "type": "string" },
                    "ceo": { "type": "string" },
                    "industry": { "type": "string" },
                    "revenue": { "type": "string" }
                },
                "required": ["company_name", "ceo", "industry"]
            }, null, 2);
            document.getElementById('inputs').value = JSON.stringify([
                { "company_name": "Apple", "company_website": "https://apple.com" },
                { "company_name": "Microsoft", "company_website": "https://microsoft.com" },
                { "company_name": "Google", "company_website": "https://google.com" }
            ], null, 2);
        });

        // Handle form submission
        document.getElementById('taskForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const apiKey = document.getElementById('apiKey').value;

            if (!apiKey) {
                alert('Please enter your Parallel API key');
                return;
            }

            const data = {
                inputs: document.getElementById('inputs').value,
                output_type: document.getElementById('outputType').value,
                processor: document.getElementById('processor').value || undefined,
                output_description: document.getElementById('outputDescription').value || undefined,
                output_schema: document.getElementById('outputSchema').value ? JSON.parse(document.getElementById('outputSchema').value) : undefined,
                webhook_url: document.getElementById('webhookUrl').value || undefined
            };

            // Try to parse inputs as JSON, otherwise treat as URL
            try {
                data.inputs = JSON.parse(data.inputs);
            } catch {
                // Keep as string (URL)
            }

            try {
                const response = await fetch('/v1beta/tasks/multitask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error(await response.text());
                }

                const resultUrl = await response.text();

                // Show results
                const resultsDiv = document.getElementById('results');
                const urlLink = document.getElementById('resultUrl');

                urlLink.href = resultUrl;
                urlLink.textContent = resultUrl;

                // Set up format links
                document.getElementById('jsonLink').href = resultUrl + '.json';
                document.getElementById('htmlLink').href = resultUrl + '.html';
                document.getElementById('mdLink').href = resultUrl + '.md';
                document.getElementById('sseLink').href = resultUrl + '.sse';
                document.getElementById('dbLink').href = resultUrl + '.db';

                resultsDiv.classList.remove('hidden');
                resultsDiv.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // Add these event listeners after the existing ones
        document.getElementById('openVscode').addEventListener('click', () => {
            const mcpUrl = 'https://multitask-demo.parallel.ai/mcp';
            const deeplink = `vscode:mcp/install?${encodeURIComponent(JSON.stringify({
                "name": "Parallel Tasks",
                "gallery": false,
                "url": mcpUrl
            }))}`;
            window.open(deeplink, '_blank');
        });

        document.getElementById('openCursor').addEventListener('click', () => {
            const mcpUrl = 'https://multitask-demo.parallel.ai/mcp';
            const config = btoa(JSON.stringify({ "url": mcpUrl }));
            const deeplink = `cursor://anysphere.cursor-deeplink/mcp/install?name=Parallel%20Tasks&config=${config}`;
            window.open(deeplink, '_blank');
        });

        document.getElementById('copyMcpUrl').addEventListener('click', async () => {
            const mcpUrl = 'https://multitask-demo.parallel.ai/mcp';
            try {
                await navigator.clipboard.writeText(mcpUrl);
                // Temporarily change button text to show success
                const button = document.getElementById('copyMcpUrl');
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.classList.remove('bg-gray-600', 'hover:bg-gray-700');
                button.classList.add('bg-green-600', 'hover:bg-green-700');
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-green-600', 'hover:bg-green-700');
                    button.classList.add('bg-gray-600', 'hover:bg-gray-700');
                }, 2000);
            } catch (err) {
                alert('Failed to copy URL to clipboard');
            }
        });
    </script>
</body>

</html>